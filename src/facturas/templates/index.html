{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" href="{% static 'bootstrap.min.css' %}"/>
</head>
<body>
{{token}}

<form id="upload_csv_file"
      action="{% url 'upload_csv_file' %}" method="POST" enctype="multipart/form-data" class="form-horizontal">
    {% csrf_token %}
    <input type="hidden" name="token" value="{{token}}">
    <div class="form-group">
        <label for="csv_file" class="col-md-3 col-sm-3 col-xs-12 control-label">File: </label>
        <div class="col-md-8">
            <input type="file" name="file" id="file" required class="">
        </div>
    </div>
    <div class="form-group">
        <label for="separator" class="col-md-3 col-sm-3 col-xs-12 control-label">Seperador: </label>
        <div class="col-md-8">
            <input type="text" max="1" name="separator" id="separator" required class="">
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-3 col-sm-3 col-xs-12 col-md-offset-3" style="margin-bottom:10px;">
            <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-upload"
                                                                style="margin-right:5px;"></span>Upload
            </button>
        </div>
    </div>
</form>

<script src="{% static 'jquery-3.3.1.min.js' %}"></script>

<script>

    const token = "{{ token }}";
    var ws = new WebSocket("ws://" + window.location.host + "/ws/upload-csv/" + token + "/");
    ws.onmessage = function (event) {
        console.log(event.data);
    };

    $("#upload_csv_file").submit(function (e) {
        e.preventDefault();
        var formData = new FormData(this);
        formData.append("token", token);
        $.ajax({
            url: $(this).attr("action"),
            type: 'POST',
            data: formData,
            success: function (data) {
                console.log(data);
            },
            cache: false,
            contentType: false,
            processData: false
        });
    });
</script>
</body>
</html>